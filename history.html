<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billing History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .bg-glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .background-radial-gradient {
            background-color: hsl(218, 41%, 15%);
            background-image: radial-gradient(650px circle at 0% 0%, hsl(218, 41%, 35%) 15%, hsl(218, 41%, 30%) 35%, hsl(218, 41%, 20%) 75%, hsl(218, 41%, 19%) 80%, transparent 100%), radial-gradient(1250px circle at 100% 100%, hsl(218, 41%, 45%) 15%, hsl(218, 41%, 30%) 35%, hsl(218, 41%, 20%) 75%, hsl(218, 41%, 19%) 80%, transparent 100%);
            min-height: 100vh;
        }
    </style>
</head>

<body>
    <section class="background-radial-gradient overflow-hidden">
        <div class="container px-4 py-5">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="card bg-glass">
                        <div class="card-body p-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2 class="card-title">Billing History</h2>
                                <div>
                                    <button class="btn btn-primary me-2" onclick="exportHistory()">Export
                                        History</button>
                                    <button class="btn btn-danger me-2" onclick="clearHistory()">Clear History</button>
                                    <button class="btn btn-secondary"
                                        onclick="window.location.href='index.html'">Back</button>
                                </div>
                            </div>
                            <div id="historyContent" class="table-responsive">
                                <!-- History will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('billingHistory')) || [];
            const historyContent = document.getElementById('historyContent');

            if (history.length === 0) {
                historyContent.innerHTML = '<p class="text-center text-muted">No billing history available</p>';
                return;
            }

            let tableHTML = `
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Room</th>
                            <th>Previous Reading</th>
                            <th>Present Reading</th>
                            <th>kWh Used</th>
                            <th>Rate</th>
                            <th>Total Bill</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            history.reverse().forEach(entry => {
                tableHTML += `
                    <tr>
                        <td>${entry.billingMonth}</td>
                        <td>${entry.room}</td>
                        <td>${entry.previousReading} kWh</td>
                        <td>${entry.presentReading} kWh</td>
                        <td>${entry.kWhUsed} kWh</td>
                        <td>₱${entry.powerRates}</td>
                        <td>₱${parseFloat(entry.totalBill).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            historyContent.innerHTML = tableHTML;
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear all billing history?')) {
                localStorage.removeItem('billingHistory');
                loadHistory();
            }
        }

        function exportHistory() {
            const history = JSON.parse(localStorage.getItem('billingHistory')) || [];
            const dataStr = JSON.stringify(history, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.download = `billing-history-${new Date().toISOString().slice(0, 10)}.json`;
            link.href = url;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Load history when page loads
        window.onload = loadHistory;
    </script>
</body>

</html>